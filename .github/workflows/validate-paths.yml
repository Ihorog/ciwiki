name: validate-paths
on: [push, pull_request]
jobs:
  paths:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Fail on control chars in paths
        run: |
          git ls-tree -rz --name-only HEAD | python3 - <<'PY'
import sys
bad=[]
data=sys.stdin.buffer.read().split(b'\0')
for p in data:
    if any(c in p for c in (b'\n', b'\r', b'\t')):
        bad.append(p.decode('utf-8','ignore'))
if bad:
    print("Invalid filenames detected:")
    print("\n".join(bad))
    sys.exit(1)
print("OK: no invalid filenames")
PY
