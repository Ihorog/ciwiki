# legend_registry.yml
# Describes the Legend Ci pipeline: source of truth, sync/build scripts, outputs, and invariants.

source_of_truth:
  file: docs/legend_ci/legend.graph.json
  description: Canonical graph. All generated content derives from this file.

scripts:
  sync:
    path: scripts/legend/sync_graph_to_markdown.py
    description: Parse graph nodes and generate deterministic chapter markdown in content/legend/**
    run: python scripts/legend/sync_graph_to_markdown.py
  build:
    path: scripts/legend/build_legend.py
    description: Build HTML pages (docs/legend/**) and JSON API (api/v1/legend/**) from content/legend/**
    run: python scripts/legend/build_legend.py
  render:
    path: scripts/legend/render.py
    description: Existing renderer â€” validates graph and generates legend.nodes.md, legend.map.mmd, legend.search.json
    run: python scripts/legend/render.py

sync_outputs:
  base: content/legend
  chapters:
    - dir: 01-pozhodzhennya
      index_range: [1, 3]
    - dir: 02-dzerkala
      index_range: [4, 7]
    - dir: 03-rytm-i-pamiat
      index_range: [8, 10]
    - dir: 04-transformatsiia-i-harmoniia
      index_range: [11, 12]
    - dir: 05-prostir-i-chas
      index_range: [13, 14]
    - dir: 06-kazkar-i-zviazky
      index_range: [15, 16]
    - dir: 07-hra-i-shliakh
      index_range: [17, 20]
  index: content/legend/index.json
  file_pattern: "{index:02d}-{id}.md"
  manual_zone_markers:
    begin: "<!-- CI:MANUAL:BEGIN -->"
    end: "<!-- CI:MANUAL:END -->"

build_outputs:
  html_pages: docs/legend/{id}/index.html
  html_index: docs/legend/index.html
  api_index: api/v1/legend/index.json
  api_node: api/v1/legend/{id}.json

invariants:
  - content/legend/** is always derived from docs/legend_ci/legend.graph.json via sync_graph_to_markdown.py
  - Manual edits are only permitted inside <!-- CI:MANUAL:BEGIN --> ... <!-- CI:MANUAL:END --> zones
  - docs/legend/** and api/v1/legend/** are always derived from content/legend/** via build_legend.py
  - All scripts are stdlib-only and run on Python 3 (Termux/Linux compatible)
  - Node file naming is deterministic: {index:02d}-{id}.md
  - Node sort order for navigation is by index field (ascending)
